# 需求追踪日志 (Requirements Tracking Log)

> 本文档记录项目开发过程中的需求提出、实现和验收反馈的完整流程

---

## 📋 需求记录格式说明

每个需求包含以下信息：
- **需求编号**：REQ-YYYYMMDD-序号
- **提出时间**：日期
- **需求描述**：简洁明确的需求说明（要点列表）
- **实现状态**：🔴 未开始 | 🟡 进行中 | 🟢 已完成 | ⚫ 已取消
- **实现记录**：具体实现的文件和改动
- **验收反馈**：用户的验收意见和后续调整

---

## 2024-10-23 需求记录

### REQ-20241023-01: 资料库分组逻辑改造

**提出时间**: 2024-10-23

**需求描述**:
1. 将资料库分组从"酸/碱/盐/氧化物/气体/其他"改为"无机物/有机物"两组
2. 保持元素周期表顺序排序
3. 所有列尽可能改为标签(chips)形式，增强可视化

**实现状态**: 🟢 已完成

**实现记录**:
- 文件：`client/src/pages/ChemistryLibrary.jsx`
- 改动：
  - 新增 `isOrganic()` 函数判断有机/无机（基于化学式含C+H且排除CO/CO2/碳酸盐，以及名称关键词）
  - 替换 `groupByType()` 为 `groupByOrganicInorganic()`
  - 将酸碱性、水解/电解、状态、其他性质列改为chips显示
  - 添加 `splitBySlash()` 和 `splitBySpace()` 辅助函数拆分标签

**验收反馈**: ✅ 已验收通过

---

### REQ-20241023-02: 资料库页面布局优化

**提出时间**: 2024-10-23

**需求描述**:
1. 缩小输入框和提示之间的间隔（当前太宽）
2. 放大显示内容（显示框和标签太小，不够人性化）
3. 反应和其他性质列需要自适应高度（根据标签数量）

**实现状态**: 🟢 已完成

**实现记录**:
- 文件：`client/src/pages/ChemistryLibrary.jsx`
  - 增大页面最大宽度：1000px → 1200px
  - 增大标题字体：默认 → 28px
  - 缩小标题和副标题间距：默认 → 8px
  - 增大分组标题字体：默认 → 22px
  - 增大分组标题左边距和下边距

- 文件：`client/src/styles/GuessesTable.css`
  - 增大表格单元格内边距：12px 16px → 14px 18px
  - 添加垂直居中对齐：vertical-align: middle
  - 增大表头字体：14px → 15px
  - 增大标签字体：12px → 14px
  - 增大标签内边距：4px 8px → 6px 12px
  - 增大标签圆角：6px → 8px
  - 增大标签间距：4px → 6px
  - 添加标签容器最小高度：32px（自适应）
  - 增大反应项字体：12px → 13px
  - 增大反应项内边距：4px 8px → 6px 12px
  - 添加反应容器最小高度：32px（自适应）
  - 新增化学式样式：16px, 加粗
  - 新增名称样式：15px, 中等粗细

**验收反馈**: 待验收

---

### REQ-20241023-03: Home页面重新设计

**提出时间**: 2024-10-23

**需求描述**:
1. 去除过于AI风的设计（彩虹渐变边框、过于花哨的动画）
2. 改进配色方案，不要过于AI风
3. 优化布局，使其更加人性化和简洁
4. 学习借鉴优秀教育类网站设计，但不要太复杂

**实现状态**: 🟢 已完成

**实现记录**:
- 文件：`client/src/styles/Home.css`
  - 移除彩虹渐变边框动画（::before伪元素及animate-border动画）
  - 简化背景：渐变 → 纯色 #f8fafc
  - 简化卡片样式：移除复杂的伪元素层叠
  - 优化hover效果：scale变换 → translateY(-4px) 上移
  - 简化阴影：减少阴影强度，更加柔和
  - 增大卡片宽度：300px → 360px
  - 增大卡片圆角：8px → 16px
  - 优化边框：透明 → hover时显示淡灰色边框
  - 化学模式卡片：移除绿色渐变背景，改为白色+hover时淡绿背景
  - 优化字体大小和间距

- 文件：`client/src/pages/Home.jsx`
  - 添加页面主标题："化学物质猜测游戏"
  - 添加副标题说明："通过属性猜测化学物质，学习高中化学知识"
  - 优化卡片标题：
    - "猜化学物质" → "开始游戏"
    - "资料库（题库）" → "浏览题库"
  - 优化卡片描述，使用<br/>换行，更清晰

**验收反馈**: 待验收

---
## 2024-10-24 需求记录

### REQ-20241024-01: 输入/提示间距与标签可视化放大

**提出时间**: 2024-10-24

**需求描述**:
1. 输入框与提示之间间距过大，需缩小
2. 标签尺寸偏小，需进一步放大，提升辨识度

**实现状态**: 🟢 已完成（待验收）

**实现记录**:
- `client/src/styles/SinglePlayer.css`: `.search-bar` 顶部间距 60px → 24px
- `client/src/styles/game.css`:
  - `.container` 顶部外边距 80px → 32px（移动端 60px → 24px）
  - `.hint-container` 内边距 8px 16px → 8px 12px
  - `.game-info-container` gap 8px → 6px
- `client/src/styles/GuessesTable.css`:
  - `.tag-chip` 字体 14px → 16px；内边距 6x12 → 8x14；圆角 8px → 10px；字重 500 → 600
  - `.chips-container` gap 6 → 8，min-height 32 → 36
  - `.reactions-container` gap 6 → 8，min-height 32 → 36
  - `.reaction-item` 字体 13px → 15px；内边距 6x12 → 8x14；圆角 6 → 8

**验收反馈**: 待验收

---

### REQ-20241024-02: 计时功能与失败判定

**提出时间**: 2024-10-24

**需求描述**:
1. 新增倒计时；计时归零或次数归零均判定为失败
2. 在页面显示倒计时

**实现状态**: 🟢 已完成（待验收）

**实现记录**:
- `client/src/pages/ChemistrySinglePlayer.jsx`:
  - 新增 `timeLeft`（默认 120s）、`startTime`、定时器逻辑
  - 新增 `endGame(isSuccess, reason)` 统一收尾；次数用尽或超时触发失败
  - UI 中展示倒计时 `mm:ss`
- `client/src/styles/game.css`：复用 `.timer` 样式

**验收反馈**: 待验收

---

### REQ-20241024-03: 错误合计窗口（折叠抽屉）

**提出时间**: 2024-10-24

**需求描述**:
1. 记录每次失败：开始时间、答案、全部猜测
2. 抽屉式展示：一行概览（时间+答案），点击展开详情
3. 支持本地持久化

**实现状态**: 🟢 已完成（待验收）

**实现记录**:
- `client/src/pages/ChemistrySinglePlayer.jsx`：
  - 新增 `failLogs`（localStorage: `chem_fail_logs`）与折叠状态 `expanded`
  - 在页面底部新增“失败记录”抽屉列表组件化结构（内联样式，后续可抽出 CSS）

**验收反馈**: 待验收

---

### REQ-20241024-04: 术语统一——将“游戏”改为“测试”

**提出时间**: 2024-10-24

**需求描述**:
1. 前端所有面向用户文案中的“游戏”替换为“测试”，凸显教育属性

**实现状态**: 🟡 部分完成（待验收）

**实现记录**:
- `client/src/pages/Home.jsx`：标题改为“化学物质猜测测试”；按钮文案“开始测试”
- `client/index.html`：页面标题改为“化学测试 & 资料库”
- `client/src/pages/ChemistrySinglePlayer.jsx`：失败提示文案更改为“测试失败”
- 未改动：历史文档（README、UI 更新总结）保留原词，待你确认是否一并替换

**验收反馈**: 待验收

---

### REQ-20241024-05: 题库 Excel 管理与自动解析

**提出时间**: 2024-10-24

**需求描述**:
1. 通过 Excel 文档维护题库（列：化学式/名称/酸碱性/水解/电解/状态/反应/其他性质）
2. 程序自动解析，支持“反应/其他性质”列多标签拆分

**实现状态**: 🔴 未开始（待依赖安装许可）

**实现计划**:
- 拟在 `server/seed/chemistry_seed.js` 增加 Excel/在线加载分支
- 需安装依赖：`xlsx`（解析本地/远程 Excel）；（可选）`googleapis`（Google Sheets 在线读取）
- 提供 CSV 公开链接的轻量级备选（无需新依赖）

**验收反馈**: 待验收

---

### REQ-20241024-06: 云端在线文档直连（自动更新）

**提出时间**: 2024-10-24

**需求描述**:
1. 部署后，服务器可直接读取在线文档（建议 Google Sheets），并缓存
2. 提供手动刷新端点或定时刷新机制

**实现状态**: 🔴 未开始

**实现计划**:
- 新增 `server/utils/googleSheetsLoader.js`（需 `googleapis`）
- 服务启动时加载；新增 `/api/admin/refresh` 刷新端点（受保护）
- 提供 `.env` 配置：`SHEET_ID`、`SHEET_RANGE`、`GOOGLE_CREDENTIALS_PATH`

**验收反馈**: 待验收
### REQ-20241024-07: Home 添加“测试记录”页，移除测试页内记录抽屉

**提出时间**: 2024-10-24

**需求描述**:
1. 在首页新增“测试记录”入口，进入独立页面查看记录
2. 测试页不再显示失败/测试记录抽屉
3. 记录展示采用“单行概览 + 点击展开详情”的抽屉式
4. 支持清空单条/全部记录
5. 记录应持久化在网页缓存中

**实现状态**: 🟢 已完成（待验收）

**实现记录**:
- 新增 `client/src/pages/TestRecords.jsx`、`client/src/styles/TestRecords.css`
- 新增 `client/src/utils/testLogs.js`（统一读写 LocalStorage: `chem_test_logs`）
- 调整 `client/src/App.jsx` 路由与 `Home.jsx` 新增卡片入口
- 移除 `ChemistrySinglePlayer.jsx` 页面底部“失败记录”展示（改为单独页面）
- `endGame()` 统一记录成功/失败测试，字段：开始/结束时间、耗时、结果、失败原因、答案、全部猜测

**验收反馈**: 待验收

---

### REQ-20241024-08: 调整倒计时与顶部控件布局（避免拥挤）

**提出时间**: 2024-10-24

**需求描述**:
1. 顶部“剩余次数/倒计时/重新开始”控件之间间隔更合理
2. 倒计时外观缩小，降低视觉重量

**实现状态**: 🟢 已完成（待验收）

**实现记录**:
- `client/src/styles/game.css`: `.game-controls` gap 16→24，并 `flex-wrap: wrap`
- `client/src/styles/game.css`: `.timer` 字体、内边距、圆角、边框与投影整体收紧

**验收反馈**: 待验收

---


---


### REQ-20241024-09: 细化布局——缩小搜索栏与容器间距，增加提示与表格间距

**提出时间**: 2024-10-24

**需求描述**:
- `search-bar` 与下方 `.container` 距离过大
- `.game-info-container`（含提示/控制）与表格之间需留白

**实现状态**: 🟢 已完成（待验收）

**实现记录**:
- `client/src/styles/SinglePlayer.css`: 新增 `.single-player-container .container { margin-top: 12px }`
- `client/src/styles/SinglePlayer.css`: `.game-info-container { margin-bottom: 12px }`
- `client/src/styles/GuessesTable.css`: `.table-container { margin-top: 12px }`

**验收反馈**: 待验收

---

### REQ-20241024-10: 修复“正确答案括号为空”的问题

**提出时间**: 2024-10-24

**需求描述**: 失败记录中“答案：CH3COOH（ ）”无名称

**实现状态**: 🟢 已完成（待验收）

**实现记录**:
- `ChemistrySinglePlayer.jsx`: 开局后按公式调用 `searchChemistry()` 补全名称
- `endGame()` 若仍缺失名称，再次查表兜底后写入记录
- `TestRecords.jsx`: 首次加载时为历史记录缺失名称的条目批量补全并回写

**验收反馈**: 待验收

---

### REQ-20241024-11: 计时器在后台挂起导致时长异常（如777s）

**提出时间**: 2024-10-24

**需求描述**: 采用 wall-clock 方式倒计时，保证无论页面是否后台挂起都在超时点结束

**实现状态**: 🟢 已完成（待验收）

**实现记录**:
- `ChemistrySinglePlayer.jsx`: 以 `deadline = startTime + maxSeconds*1000` 计算剩余时间；每秒重算 `remaining=ceil((deadline-Now)/1000)`，在 `remaining<=0` 时调用 `endGame('timer')`

**验收反馈**: 待验收

---

### REQ-20241024-12: 测试记录——归并相同错误 + 悬浮化学式展示详情

**提出时间**: 2024-10-24

**需求描述**:
- 归并相同错误答案并统计次数
- 鼠标悬浮化学式，展示该物质的标签详情

**实现状态**: 🟢 已完成（待验收）

**实现记录**:
- `TestRecords.jsx`: 新增“错误汇总（按答案归并）”板块；新增 `FormulaHover` 组件（悬浮异步加载并显示标签）
- `TestRecords.css`: 新增 hover 卡片样式与归并列表样式

**验收反馈**: 待验收

---

### REQ-20241024-13: 在线文档题库与云端部署（方案评审）

**提出时间**: 2024-10-24

**需求描述**: 以腾讯文档在线表格维护题库，服务端定期/按需拉取更新并热加载

**实现状态**: 🟡 规划中（待你确认方案与授权）

**拟定方案**:
- 方案A（无鉴权，最快落地）: 腾讯文档发布为 CSV 公开链接，后端拉取并解析（建议使用 `papaparse` 或 `csv-parse`）
- 方案B（私有表）: 若腾讯文档提供受控 API，则以服务号/密钥鉴权读取；否则保底支持定点 HTTPS 下载 Excel（需 `xlsx`）
- 字段映射：化学式/名称/酸碱性/水解电解/状态/反应/其他性质；反应与其他性质以 `/` 分隔为多标签
- 配置：`DOC_CSV_URL` 或 `DOC_EXCEL_URL` 环境变量；提供 `/api/admin/refresh` 刷新端点

**需你确认/授权**:
- 是否采用“发布为 CSV”公开读取？
- 是否同意安装依赖：`papaparse` 或 `csv-parse`（CSV）；`xlsx`（Excel）？
- 是否需要我提供标准模板与数据校验/报错反馈？

**验收反馈**: 待验收

---

### REQ-20241024-14: 悬浮卡片显示完整七列信息

**提出时间**: 2024-10-24

**需求描述**:
- 鼠标悬浮化学式时，显示该物质“化学式/名称/酸碱性/水解/电解/状态/反应/其他性质”七列完整信息

**实现状态**: 🟢 已完成（待验收）

**实现记录**:
- `client/src/pages/TestRecords.jsx`：`FormulaHover` 组件由标签chips改为信息栅格（hover-grid）
- `client/src/styles/TestRecords.css`：新增 `.hover-grid`、`.row`、`.k`、`.v` 样式

---

### REQ-20241024-15: 非重复“洗牌袋”随机算法

**提出时间**: 2024-10-24

**需求描述**:
- 使用短袋（默认30）的洗牌抽取，袋用尽再重洗，降低短时重复

**实现状态**: 🟢 已完成（可配置 CHEM_BAG_SIZE）

**实现记录**:
- `server/seed/chemistry_seed.js`：新增袋、洗牌与补袋逻辑；`getRandomQuestion()` 从袋中取题

---

### REQ-20241024-16: 生成题库本地模板（CSV，可由Excel打开）

**提出时间**: 2024-10-24

**需求描述**:
- 按当前题库导出本地CSV模板，列：化学式/名称/酸碱性/水解/电解/状态/反应/其他性质

**实现状态**: 🟢 已完成（待你本机执行脚本）

**实现记录**:
- `server/scripts/export_chemistry_csv.js`：读取 `server/data/chemistry_questions.json` 生成 `server/data/chemistry_questions_export.csv`

---

### REQ-20241024-17: 无登录排行榜（机器绑定 + 自定义名称/班级）

**提出时间**: 2024-10-24

**需求描述**:
- 通过机器ID绑定统计，支持设置用户名与班级；统计正确局数/总局数；首页展示榜单与班级汇总

**实现状态**: 🟢 已完成（待验收）

**实现记录**:
- 后端：`server/utils/leaderboard.js`（文件存储）；`/api/score/*` 端点
- 前端：`client/src/utils/leaderboard.js`、`client/src/components/LeaderboardWidget.jsx`、`client/src/pages/Home.jsx` 集成
- 游戏同步：`ChemistrySinglePlayer.jsx` 结束一局后自动汇总本地记录并上报

---

### REQ-20241027-01: Excel 打开 CSV 中文乱码修复

**提出时间**: 2025-10-27

**需求描述**:
- VSCode 打开正常，Excel/转为 xlsx 显示乱码

**实现状态**: 🟢 已完成（待你本机重新导出验证）

**实现记录**:
- `server/scripts/export_chemistry_csv.js`：以 UTF-8 带 BOM 写出文件
- `server/seed/chemistry_seed.js`：解析远程 CSV 时去除 BOM

---

### REQ-20241027-02: 排行榜与个人设置精简

**提出时间**: 2025-10-27

**需求描述**:
- 仅保留个人名称；移除班级与当前统计
- 右上角新增悬浮横条替代设置入口
- 排行榜重命名为 TOP，移除班级筛选与汇总，仅保留一张表

**实现状态**: 🟢 已完成（待验收）

**实现记录**:
- 前端：`client/src/components/ProfileBar.jsx` 顶部悬浮；`client/src/components/LeaderboardWidget.jsx` 简化为 TOP 单表
- 工具：`client/src/utils/leaderboard.js` 移除班级字段；上报仅携带 username

---

### REQ-20241027-03: Home 采用液态玻璃风格与莫奈色系

**提出时间**: 2025-10-27

**需求描述**:
- 一行两列（共四模块）：第一列包含“开始测试”和“TOP 排行榜”
- 采用玻璃拟态 + 色板（Rosewater/Velvet Morning/Dark Denim/Bright White）

**实现状态**: 🟡 部分完成（已落地样式与结构，色值可继续微调）

**实现记录**:
- `client/src/styles/Home.css`：新增 CSS 变量与 glass 工具类、悬浮设置条样式
- `client/src/pages/Home.jsx`：改为 2x2 布局，引入 `ProfileBar` 与封装后的 `LeaderboardWidget`



## 历史需求记录（2024-10-16 至 2024-10-22）

### REQ-20241016-01: 项目从动漫角色猜测转换为化学物质猜测

**提出时间**: 2024-10-16

**需求描述**:
1. 完全重构项目，从动漫角色猜测游戏改为化学物质猜测游戏
2. 创建化学数据结构和题库
3. 实现化学物质搜索和比较逻辑
4. 创建化学专用UI组件

**实现状态**: 🟢 已完成

**验收反馈**: ✅ 已验收通过

---

### REQ-20241019-01: 清理所有动漫相关内容

**提出时间**: 2024-10-19

**需求描述**:
1. 移除所有弹窗（欢迎、设置、帮助、游戏结束）
2. 移除动漫游戏模式路由
3. 移除社交链接、计时器、投降按钮、提示系统
4. 清理主页，只保留化学游戏
5. 删除未使用的动漫组件和数据文件
6. 将资料库链接改为页面内导航

**实现状态**: 🟢 已完成

**验收反馈**: ✅ 已验收通过

---

### REQ-20241020-01: 游戏机制优化

**提出时间**: 2024-10-20

**需求描述**:
1. 修复化学式不显示的问题
2. 修复名称对齐问题
3. 实现标签拆分（所有"/"分隔的值拆分为独立chips）
4. 增强比较逻辑，支持部分匹配（黄色高亮）
5. 修复酸碱相似性检测（同类酸或同类碱→黄色）
6. 修复水解/电解比较（拆分为两个独立标签，精确匹配→绿色）
7. 游戏结束时显示答案行

**实现状态**: 🟢 已完成

**验收反馈**: ✅ 已验收通过

---

## 📝 使用说明

1. **提出新需求时**：
   - 创建新的需求条目，分配编号 REQ-YYYYMMDD-序号
   - 清晰列出需求要点
   - 设置状态为 🔴 未开始

2. **开始实现时**：
   - 更新状态为 🟡 进行中
   - 记录实现的文件和主要改动

3. **完成实现后**：
   - 更新状态为 🟢 已完成
   - 等待用户验收

4. **验收反馈后**：
   - 记录用户的验收意见
   - 如需调整，在实现记录中补充
   - 最终标记为 ✅ 已验收通过

---

## 🎯 当前进行中的需求

**前端开发阶段已基本完成，现进入后端部署阶段**

---

## 2025-10-28 部署阶段需求记录

### REQ-20251028-01: 后端部署环境准备与配置

**提出时间**: 2025-10-28

**需求描述**:
1. 准备后端环境（选择云服务商：Vercel/Railway/Render/自建服务器）
2. 配置环境变量（数据库连接、题库文档URL、端口等）
3. 配置数据持久化方案（排行榜数据存储）
4. 设置 CORS 与前后端连接
5. 准备部署脚本与 CI/CD 配置

**实现状态**: 🟢 已完成

**实现记录**:
- 创建 `server/.env.example`（完整的环境变量模板，包含96行配置说明）
- 创建 `client/.env.example`（前端环境变量模板，包含49行配置说明）
- 创建 `DEPLOYMENT.md`（完整部署指南，包含三种部署方案）
- 创建 `deploy-check.js`（部署前检查脚本）
- 推荐部署方案：Railway（一站式部署，支持前后端+持久化存储）
- 配置说明：
  - 后端关键变量：PORT, CLIENT_URL, SERVER_URL, CHEM_CSV_URL, LEADERBOARD_STORAGE
  - 前端关键变量：VITE_SERVER_URL, VITE_SOCKET_URL, VITE_AES_SECRET
  - 支持在线题库（腾讯文档 CSV / Google Sheets）
  - 支持两种存储方案：文件存储（小规模）/ MongoDB（大规模）

**验收反馈**: 待验收

---

### REQ-20251028-02: 在线题库集成（腾讯文档/Google Sheets）

**提出时间**: 2025-10-28

**需求描述**:
1. 实现从在线文档（腾讯文档 CSV 或 Google Sheets）拉取题库
2. 支持定时/手动刷新题库
3. 提供题库数据校验与错误反馈
4. 实现题库缓存机制

**实现状态**: 🔴 未开始

**实现计划**:
- 方案A：腾讯文档发布为 CSV 公开链接（无需鉴权，最快）
- 方案B：Google Sheets API（需要 API Key）
- 新增 `server/utils/remoteDataLoader.js`
- 新增 `/api/admin/refresh-questions` 刷新端点
- 配置环境变量：`QUESTIONS_CSV_URL` 或 `GOOGLE_SHEET_ID`

**验收反馈**: 待验收

---

### REQ-20251028-03: 排行榜数据持久化（云端存储）

**提出时间**: 2025-10-28

**需求描述**:
1. 将排行榜从本地文件存储迁移到云端数据库
2. 支持多用户并发访问
3. 实现数据备份机制

**实现状态**: 🔴 未开始

**实现计划**:
- 方案A：使用 MongoDB Atlas（免费层）
- 方案B：使用 PostgreSQL（Supabase/Railway）
- 方案C：使用 Redis（Upstash）
- 方案D：保持文件存储（适用于小规模部署）
- 更新 `server/utils/leaderboard.js` 支持数据库连接

**验收反馈**: 待验收

---

### REQ-20251028-04: 前端部署与静态资源优化

**提出时间**: 2025-10-28

**需求描述**:
1. 构建生产版本前端代码
2. 配置前端部署（Vercel/Netlify/GitHub Pages）
3. 优化静态资源加载（压缩、CDN）
4. 配置前后端 API 连接

**实现状态**: 🔴 未开始

**实现计划**:
- 运行 `npm run build` 构建前端
- 配置 `vite.config.js` 生产环境设置
- 设置环境变量 `VITE_API_URL`
- 部署到静态托管平台

**验收反馈**: 待验收

---

### REQ-20251028-05: 部署测试与监控

**提出时间**: 2025-10-28

**需求描述**:
1. 端到端测试部署后的应用
2. 配置错误监控与日志
3. 性能测试与优化
4. 编写运维文档

**实现状态**: 🔴 未开始

**实现计划**:
- 测试所有功能端点
- 配置日志系统（Winston/Pino）
- 设置健康检查端点 `/api/health`
- 编写故障排查文档

**验收反馈**: 待验收


